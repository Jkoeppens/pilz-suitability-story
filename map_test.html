<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Suitability Test Map</title>

  <meta name="viewport" content="initial-scale=1, maximum-scale=1" />

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- GeoTIFF Tools -->
  <script src="https://unpkg.com/georaster"></script>
  <script src="https://unpkg.com/georaster-layer-for-leaflet"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }
    #map {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>

<body>
<div id="map"></div>

<script>
  // 1) Leaflet Map
  const map = L.map("map", {
    center: [52.5, 13.4],   // Berlin
    zoom: 10
  });

  // 2) Basemap
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19
  }).addTo(map);

  // 3) GeoTIFF laden
  fetch("data/suitability.tif")
    .then(res => res.arrayBuffer())
    .then(buffer => georaster = parseGeoraster(buffer))
    .then(georaster => {

      // 4) Layer erzeugen
      const layer = new GeoRasterLayer({
        georaster,
        opacity: 0.85,
        resolution: 256,

        // 5) QGIS-ähnliches Color-Mapping
        pixelValuesToColorFn: function(values) {
          const v = values[0]; // 1-Band TIFF

          if (v === null) return null;

          // Beispiel-Farbpalette (grün → gelb → rot)
          return v < 0.2 ? "#1a9850" :
                 v < 0.4 ? "#91cf60" :
                 v < 0.6 ? "#d9ef8b" :
                 v < 0.8 ? "#fee08b" :
                           "#fc8d59";
        }
      });

      layer.addTo(map);
      map.fitBounds(layer.getBounds());
    })
    .catch(err => console.error("Fehler beim Laden des TIFF:", err));
</script>

</body>
</html>