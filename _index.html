<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Ich sage Pilze voraus</title>

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Finlandica -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Finlandica:wght@400;600;700&display=swap"
        rel="stylesheet">

  <!-- Deine CSS -->
  <link rel="stylesheet" href="style_1.css" />

  <!-- Markdown Parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
<div id="app">

  <!-- =========================================================
       FIXER MEDIEN-HINTERGRUND (Alle Bühnen liegen übereinander)
       ======================================================= -->
  <div id="media-root">

    <!-- BÜHNE 1 – WALD / PILZ -->
    <div class="media-group" data-media="1">
      <img src="img/Wald.png" class="bg-img" alt="Wald">
      <img src="img/Pilz.png" class="overlay-img overlay-pilz" alt="Pilz">
    </div>

    <!-- BÜHNE 2 – SAT BERLIN -->
    <div class="media-group" data-media="2">
      <img src="img/Sat_Berlin.png" class="bg-img" alt="Berlin">
      <img src="img/Parasolfunde.png" class="overlay-img overlay-parasolfunde" alt="Parasolfunde">
    </div>

    <!-- BÜHNE 3 – GRUNEWALD -->
    <div class="media-group" data-media="3">
      <img src="img/Grunewald.png" class="bg-img" alt="Grunewald">
      <img src="img/Parasol_Grunewald.png" class="overlay-img overlay-parasol-grunewald">
      <img src="img/Meisenfunde_Grunewald.png" class="overlay-img overlay-meisen-grunewald">
    </div>

    <!-- BÜHNE 4 – VIERERKARTE + CHARTS + SUITABILITY -->
    <div class="media-group" data-media="4">
      <img src="img/Satteliten_Viererkarte.png" class="bg-img">
      <img src="img/Fundpunkte_all_berlin.png" class="overlay-img overlay-fundpunkte">

      <!-- Charts -->
      <div class="overlay-img overlay-charts">
        <div class="charts-grid">
          <figure class="chart"><img src="img/roc_growing.gif"></figure>
          <figure class="chart"><img src="img/calibration_curve_final.gif"></figure>
          <figure class="chart"><img src="img/probability_histogram_once.gif"></figure>
          <figure class="chart"><img src="img/feature_importances_pause.gif"></figure>
        </div>
      </div>

      <!-- Suitability -->
      <img src="img/Suitability_berlin.png" class="overlay-img overlay-suitability">
    </div>

  </div>
  <!-- /#media-root -->


  <!-- =========================================================
       SCROLL-LAYER (Text triggert Medienwechsel)
       ======================================================= -->
  <main id="scroll-root">

    <!-- STAGE 1 -->
    <section class="text-stage" data-media="1">

      <article class="text-step spacing-short" data-md="slide1_01_intro.md"></article>

      <article class="text-step spacing-long"
               data-md="slide1_02_body.md"
               data-stage-classes="show-pilz"></article>
    </section>


    <!-- STAGE 2 -->
    <section class="text-stage" data-media="2">

      <article class="text-step spacing-short" data-md="slide2_01_intro.md"></article>

      <article class="text-step spacing-long"
               data-md="slide2_02_parasol.md"
               data-stage-classes="show-parasolfunde"></article>
    </section>


    <!-- STAGE 3 -->
    <section class="text-stage" data-media="3">

      <article class="text-step spacing-short" data-md="slide3_01_intro.md"></article>

      <article class="text-step spacing-short"
               data-md="slide3_02_parasol.md"
               data-stage-classes="show-parasol-grunewald"></article>

      <article class="text-step spacing-short"
               data-md="slide3_03_meisen.md"
               data-stage-classes="show-parasol-grunewald show-meisen-grunewald"></article>

      <article class="text-step spacing-long"
               data-md="slide3_04_bias_text.md"
               data-stage-classes="show-parasol-grunewald show-meisen-grunewald"></article>
    </section>


    <!-- STAGE 4 -->
    <section class="text-stage" data-media="4">

      <article class="text-step spacing-short" data-md="slide4_01_signatures.md"></article>

      <article class="text-step spacing-short"
               data-md="slide5_01_model_intro.md"
               data-stage-classes="show-fundpunkte"></article>

      <article class="text-step spacing-short"
               data-md="slide6_01_charts.md"
               data-stage-classes="show-fundpunkte show-charts"></article>

      <article class="text-step spacing-long"
               data-md="slide7_01_prediction_intro.md"
               data-stage-classes="show-fundpunkte show-charts"></article>

      <article class="text-step spacing-short"
               data-md="slide7_02_prediction_explain.md"
               data-stage-classes="show-fundpunkte"></article>

      <article class="text-step spacing-xlong"
               data-md="slide7_03_prediction_suitability.md"
               data-stage-classes="show-suitability"></article>
    </section>

  </main>
</div>


<!-- =========================================================
     Skripte
     ======================================================= -->
<script>
  /* MARKDOWN LADEN */
  function loadMarkdownIntoSteps() {
    document.querySelectorAll(".text-step").forEach(step => {
      const file = step.dataset.md;
      if (!file) return;

      fetch(`text/${file}`)
        .then(r => r.text())
        .then(t => step.innerHTML = marked.parse(t))
        .catch(err => step.innerHTML = `<p class="load-error">Fehler: ${file}</p>`);
    });
  }


  /* SCROLL-LOGIK */
  function initScrollStates() {
    const mediaGroups = [...document.querySelectorAll(".media-group")];
    const steps = [...document.querySelectorAll(".text-step")];

    const KNOWN = [
      "show-pilz","show-parasolfunde","show-parasol-grunewald",
      "show-meisen-grunewald","show-fundpunkte","show-charts","show-suitability"
    ];

    function activateMedia(id) {
      mediaGroups.forEach(g => {
        const visible = g.dataset.media === id;
        g.classList.toggle("is-visible", visible);
        KNOWN.forEach(cls => g.classList.remove(cls));
      });
    }

    const obs = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (!e.isIntersecting) return;

        const step = e.target;
        steps.forEach(s => s.classList.remove("is-active"));
        step.classList.add("is-active");
        step.classList.add("was-active");

        const stage = step.closest(".text-stage");
        const mediaId = stage.dataset.media;
        activateMedia(mediaId);

        const group = mediaGroups.find(g => g.dataset.media === mediaId);
        if (!group) return;

        const classes = (step.dataset.stageClasses || "")
          .split(" ").filter(Boolean);
        classes.forEach(c => group.classList.add(c));
      });
    }, { threshold: 0.55 });

    steps.forEach(step => obs.observe(step));

    // initialer Zustand
    const firstMedia = steps[0].closest(".text-stage").dataset.media;
    activateMedia(firstMedia);
    steps[0].classList.add("is-active", "was-active");
  }


  document.addEventListener("DOMContentLoaded", () => {
    loadMarkdownIntoSteps();
    initScrollStates();
  });
</script>

</body>
</html>